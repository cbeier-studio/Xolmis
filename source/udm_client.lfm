object DMC: TDMC
  OnCreate = DataModuleCreate
  OldCreateOrder = False
  Height = 520
  HorizontalOffset = 352
  VerticalOffset = 33
  Width = 763
  object qIndividualsMonth: TSQLQuery
    PacketRecords = 1
    IndexName = 'DEFAULT_ORDER'
    MaxIndexesCount = 4
    FieldDefs = <    
      item
        Name = 'id'
        DataType = ftLargeint
        Precision = -1
      end    
      item
        Name = 'record_month'
        DataType = ftString
        Precision = -1
        Size = 15
      end    
      item
        Name = 'quantity'
        DataType = ftLargeint
        Precision = -1
      end>
    Database = DMM.sqlCon
    Transaction = DMM.sqlTrans
    ReadOnly = True
    SQL.Strings = (
      'WITH MonthlyCaptures AS ('
      '    SELECT'
      '        STRFTIME(''%Y-%m'', capture_date) AS record_month,'
      '        COUNT(capture_id) AS quantity'
      '    FROM'
      '        captures'
      '    WHERE'
      '        capture_date > DATE(''now'', ''-12 months'')'
      '    GROUP BY'
      '        record_month'
      ')'
      'SELECT'
      '    ROW_NUMBER() OVER (ORDER BY record_month) AS id,'
      '    record_month,'
      '    quantity'
      'FROM'
      '    MonthlyCaptures'
      'ORDER BY'
      '    record_month ASC'
    )
    Params = <>
    Macros = <>
    Left = 557
    Top = 105
    object qIndividualsMonthid: TLongintField
      FieldKind = fkData
      FieldName = 'id'
      Index = 0
      LookupCache = False
      ProviderFlags = [pfInWhere, pfInKey]
      ReadOnly = False
      Required = False
    end
    object qIndividualsMonthrecord_month: TStringField
      FieldKind = fkData
      FieldName = 'record_month'
      Index = 1
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
      Size = 15
    end
    object qIndividualsMonthquantity: TLongintField
      FieldKind = fkData
      FieldName = 'quantity'
      Index = 2
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
    end
  end
  object dsIndividualsMonth: TDataSource
    AutoEdit = False
    DataSet = qIndividualsMonth
    Left = 442
    Top = 105
  end
  object dsSpeciesMonth: TDataSource
    AutoEdit = False
    DataSet = qSpeciesMonth
    Left = 442
    Top = 173
  end
  object qSpeciesMonth: TSQLQuery
    PacketRecords = 1
    IndexName = 'DEFAULT_ORDER'
    MaxIndexesCount = 4
    FieldDefs = <    
      item
        Name = 'id'
        DataType = ftLargeint
        Precision = -1
      end    
      item
        Name = 'record_month'
        DataType = ftString
        Precision = -1
        Size = 15
      end    
      item
        Name = 'quantity'
        DataType = ftLargeint
        Precision = -1
      end>
    Database = DMM.sqlCon
    Transaction = DMM.sqlTrans
    ReadOnly = True
    SQL.Strings = (
      'WITH CombinedData AS ('
      '    SELECT'
      '        STRFTIME(''%Y-%m'', t.capture_date) AS record_month,'
      '        t.taxon_id AS taxon'
      '    FROM captures AS t'
      '    WHERE t.active_status = 1'
      ''
      '    UNION ALL'
      ''
      '    SELECT'
      '        STRFTIME(''%Y-%m'', s.sighting_date) AS record_month,'
      '        s.taxon_id AS taxon'
      '    FROM sightings AS s'
      '    WHERE s.active_status = 1'
      '),'
      'MonthlyCounts AS ('
      '    SELECT'
      '        record_month,'
      '        COUNT(DISTINCT taxon) AS quantity'
      '    FROM'
      '        CombinedData'
      '    GROUP BY'
      '        record_month'
      ')'
      'SELECT'
      '    ROW_NUMBER() OVER (ORDER BY record_month) AS id,'
      '    record_month,'
      '    quantity'
      'FROM'
      '    MonthlyCounts'
      'WHERE'
      '    record_month > STRFTIME(''%Y-%m'', ''now'', ''-12 months'')'
      'ORDER BY'
      '    record_month ASC'
    )
    Params = <>
    Macros = <>
    Left = 557
    Top = 173
    object qIndividualsMonthid1: TLongintField
      FieldKind = fkData
      FieldName = 'id'
      Index = 0
      LookupCache = False
      ProviderFlags = [pfInWhere, pfInKey]
      ReadOnly = False
      Required = False
    end
    object qIndividualsMonthrecord_month1: TStringField
      FieldKind = fkData
      FieldName = 'record_month'
      Index = 1
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
      Size = 15
    end
    object qIndividualsMonthquantity1: TLongintField
      FieldKind = fkData
      FieldName = 'quantity'
      Index = 2
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
    end
  end
  object dsBandsBalance: TDataSource
    AutoEdit = False
    Left = 184
    Top = 32
  end
  object qBandsBalance: TSQLQuery
    FieldDefs = <    
      item
        Name = 'band_size'
        DataType = ftString
        Precision = -1
        Size = 5
      end    
      item
        Name = 'saldo'
        DataType = ftInteger
        Precision = -1
      end    
      item
        Name = 'media_dia'
        DataType = ftFloat
        Precision = 15
      end    
      item
        Name = 'maximo_dia'
        DataType = ftInteger
        Precision = -1
      end>
    Database = DMM.sqlCon
    Transaction = DMM.sqlTrans
    SQL.Strings = (
      'SELECT band_size, saldo, media_dia, maximo_dia'
      'FROM get_bands_leftover'
      ''
    )
    Params = <>
    Macros = <>
    Left = 64
    Top = 32
    object qBandsBalanceband_size: TStringField
      Alignment = taCenter
      DisplayLabel = 'Tamanho'
      DisplayWidth = 10
      FieldKind = fkData
      FieldName = 'band_size'
      Index = 0
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
      Size = 5
    end
    object qBandsBalancesaldo: TLongintField
      DisplayLabel = 'Saldo'
      FieldKind = fkInternalCalc
      FieldName = 'saldo'
      Index = 1
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
      DisplayFormat = '#,##0'
    end
    object qBandsBalancemedia_dia: TFloatField
      DisplayLabel = 'Média/dia'
      FieldKind = fkInternalCalc
      FieldName = 'media_dia'
      Index = 2
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
      DisplayFormat = '#,##0.0'
    end
    object qBandsBalancemaximo_dia: TLongintField
      DisplayLabel = 'Máx./dia'
      FieldKind = fkInternalCalc
      FieldName = 'maximo_dia'
      Index = 3
      LookupCache = False
      ProviderFlags = [pfInUpdate, pfInWhere]
      ReadOnly = False
      Required = False
      DisplayFormat = '#,##0'
    end
  end
end
